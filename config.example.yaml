# SocksBalance Configuration

# Listen address for incoming connections
listen: "0.0.0.0:1080"

# Proxy mode:
#   - transparent: Zero-copy TCP forwarding (fastest, recommended)
#   - socks5: Full SOCKS5 protocol handling (decode/re-encode)
mode: "transparent"

# Backend SOCKS5 proxy servers
# Supports single ports and port ranges
backends:
  # Single backend
  - address: "192.168.1.100:1080"
    name: "Primary Proxy"

  # Port range (expands to multiple backends)
  # Format: host:startPort-endPort
  # Example: 127.0.0.1:9070-9089 creates 20 backends (9070, 9071, ..., 9089)
  - address: "127.0.0.1:9070-9089"
    name: "Tor Instances"

  # Another range example
  - address: "192.168.1.200:10800-10810"
    name: "Proxy Farm"

  # IPv6 support (single and ranges)
  - address: "[::1]:1080"
    name: "IPv6 Local"
  
  - address: "[2001:db8::1]:8080-8082"
    name: "IPv6 Range"

# Health check configuration
health:
  # URL to test through backends (HTTP/HTTPS)
  test_url: "https://www.google.com"
  
  # How often to check backend health
  check_interval: 10s
  
  # Maximum time to wait for backend connection
  connect_timeout: 5s
  
  # Maximum time to wait for full HTTP request
  request_timeout: 10s
  
  # Number of failures before marking backend unhealthy
  failure_threshold: 3
  
  # --- CIRCUIT BREAKER (AUTOMATIC FAILOVER) ---
  # Use real connection outcomes for health monitoring
  # Backends handling traffic are monitored passively
  # Failed backends are probed periodically for recovery
  passive_monitoring: true
  
  # Circuit breaker: consecutive failures before removing backend from rotation
  # When a backend fails this many times in a row, it's automatically removed
  # and the load balancer switches to another healthy backend
  circuit_threshold: 3
  
  # Time between recovery probes for failed backends
  # Failed backends are tested at this interval to check if they've recovered
  # Exponential backoff: 10s → 20s → 40s → 60s (max)
  recovery_interval: 30s
  
  # Sliding window size for connection success rate tracking
  # Tracks the last N connection attempts to calculate success rate
  metrics_window_size: 10

# Load balancer configuration
balancer:
  # Algorithm: roundrobin (only option currently)
  # Backends are automatically sorted by latency
  algorithm: "roundrobin"
  
  # Maximum latency threshold (IMPORTANT for stability!)
  # Only backends with latency <= this value will be used
  # Set to 0 to disable (use all healthy backends)
  # Recommended: 500ms-2000ms depending on your needs
  # Example: 1000ms = only use backends faster than 1 second
  max_latency: 1000ms
  
  # Sticky session TTL (CRITICAL for multi-request apps like Twitter!)
  # Keeps the same client IP connected to the same backend
  # This prevents connection switching mid-session
  # Set to 0 to disable sticky sessions
  # Recommended: 5m-30m for web browsing
  sticky_session_ttl: 10m
  
  # Maximum number of active backends to use concurrently (GFW EVASION!)
  # Only the top N fastest backends will be used
  # This prevents all backends from being detected/blocked at once
  # Set to 0 to use all available backends
  # Recommended: 3-5 for anti-detection
  # Example: If you have 20 Tor circuits, only use the 3 fastest
  max_active_backends: 3

# Web dashboard configuration
web:
  # Enable web monitoring dashboard
  enabled: true
  
  # Dashboard listen address
  # SECURITY: Bind to 127.0.0.1 (localhost) by default
  # Only change to 0.0.0.0 if you need remote access (not recommended)
  listen: "127.0.0.1:8080"
  
  # Frontend auto-refresh interval in seconds
  # How often the dashboard polls for backend updates
  refresh_interval: 2

# Logging configuration
log:
  # Level: debug, info, warn, error
  level: "info"
  
  # Format: text, json
  format: "text"
